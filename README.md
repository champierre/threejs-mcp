# Three.js 立方体ジェネレーター

このプロジェクトは、Three.jsを使用して、ボタンを押すと10x10x10の立方体オブジェクトが追加されるウェブアプリケーションです。また、HTTP APIを通じて外部からも立方体を追加・管理できます。追加されたオブジェクトの情報はJSONファイルに永続化されるため、サーバーを再起動しても保持されます。WebSocketを使用してリアルタイムに変更が反映されます。さらに、MCPサーバーを使用することで、Claude DesktopなどのMCPクライアントから自然言語で立方体を操作することもできます。

## 機能

- ボタンをクリックすると、シーンに10x10x10の立方体が追加されます
- マウスでカメラを操作して、3Dシーンを自由に見ることができます
- HTTP APIを使用して、外部から立方体を追加・管理できます
- 追加されたオブジェクトの情報はJSONファイルに永続化されます
- WebSocketを使用してリアルタイムに変更が反映されます
- MCPサーバーを使用して、Claude DesktopなどのMCPクライアントから自然言語で立方体を操作できます

## 使用技術

- Three.js - 3Dグラフィックスライブラリ
- Node.js - サーバーサイドJavaScript
- Express - Webアプリケーションフレームワーク
- WebSocket - リアルタイム通信
- HTML/CSS/JavaScript
- ファイルシステム - データの永続化
- Model Context Protocol (MCP) - AIモデルとローカルサーバー間の通信プロトコル

## セットアップ

1. 必要なパッケージをインストールします
   ```
   npm install
   ```

2. サーバーを起動します
   ```
   npm start
   ```

3. ブラウザで `http://localhost:3000/index.html` にアクセスします
4. APIテストページは `http://localhost:3000/test.html` でアクセス可能

### MCPサーバーのセットアップ

1. MCPサーバーを起動します
   ```
   npm run mcp
   ```

2. Claude DesktopなどのMCPクライアントで、MCPサーバーに接続します
   - サーバー名: `threejs-cube-server`
   - 説明: `Three.jsの立方体を操作するためのMCPサーバー`

## MCPサーバーの使用方法

MCPサーバーは、Claude DesktopなどのMCPクライアントから自然言語で立方体を操作するためのツールとリソースを提供します。

### 提供されるツール

#### 立方体を追加 (add_cube)

自然言語で立方体を追加できます。サイズ、色、位置、回転を指定できます。

例：
- 「赤い立方体を追加して」
- 「サイズ20の青い立方体を中央に追加して」
- 「X座標10、Y座標15、Z座標-5の位置に緑色の立方体を追加して」

パラメータ：
- `size`: 立方体のサイズ（デフォルト: 10）
- `color`: 立方体の色（16進数形式、例: "#ff0000"）
- `position`: 立方体の位置（x, y, z座標）
- `rotation`: 立方体の回転（x, y, z軸周りの回転、ラジアン単位）

#### 立方体を削除 (delete_cube)

指定されたIDの立方体を削除します。

例：
- 「ID 1234567890の立方体を削除して」

パラメータ：
- `id`: 削除する立方体のID（必須）

#### すべての立方体を削除 (clear_cubes)

すべての立方体を削除します。

例：
- 「すべての立方体を削除して」
- 「シーンをクリアして」

### 提供されるリソース

#### すべての立方体 (all_cubes)

現在シーンに存在するすべての立方体の情報を取得します。

例：
- 「現在のシーンにある立方体を教えて」
- 「すべての立方体の情報を表示して」

#### 特定の立方体 (cube)

指定されたIDの立方体の情報を取得します。

例：
- 「ID 1234567890の立方体の情報を教えて」

パラメータ：
- `id`: 取得する立方体のID（必須）

## 使い方

1. 「立方体を追加」ボタンをクリックして、シーンに立方体を追加します
2. マウスでドラッグして視点を変更できます

## データの永続化

このアプリケーションでは、追加された立方体のデータは`data.json`ファイルに保存されます。これにより、サーバーを再起動しても立方体のデータが保持されます。データファイルは自動的に作成・更新されるため、特別な設定は必要ありません。

## リアルタイム更新

このアプリケーションでは、WebSocketを使用してリアルタイムに変更を反映します。立方体が追加・削除されると、接続されているすべてのクライアントに通知が送信され、自動的に画面が更新されます。これにより、複数のクライアントから同時にアクセスしても、すべてのクライアントで同じ立方体が表示されます。

## HTTP API

このアプリケーションは、外部からアクセスできるHTTP APIを提供しています。すべてのAPI操作はデータファイルに永続化され、WebSocketを通じてリアルタイムに通知されます。

### 立方体の追加

```
POST /api/cubes
```

curlコマンド例:
```bash
curl -X POST http://localhost:3000/api/cubes \
  -H "Content-Type: application/json" \
  -d '{
    "size": 15,
    "color": 16711680,
    "position": { "x": 0, "y": 10, "z": 0 },
    "rotation": { "x": 0, "y": 0, "z": 0 }
  }'
```

リクエスト例:
```json
{
  "size": 15,
  "color": 16711680,
  "position": { "x": 0, "y": 10, "z": 0 },
  "rotation": { "x": 0, "y": 0, "z": 0 }
}
```

レスポンス例:
```json
{
  "id": 1618456789012,
  "size": 15,
  "color": 16711680,
  "position": { "x": 0, "y": 10, "z": 0 },
  "rotation": { "x": 0, "y": 0, "z": 0 }
}
```

### すべての立方体を取得

```
GET /api/cubes
```

curlコマンド例:
```bash
curl -X GET http://localhost:3000/api/cubes
```

レスポンス例:
```json
[
  {
    "id": 1618456789012,
    "size": 15,
    "color": 16711680,
    "position": { "x": 0, "y": 10, "z": 0 },
    "rotation": { "x": 0, "y": 0, "z": 0 }
  },
  {
    "id": 1618456789013,
    "size": 10,
    "color": 65280,
    "position": { "x": 10, "y": 5, "z": -5 },
    "rotation": { "x": 0.5, "y": 0.3, "z": 0.1 }
  }
]
```

### 特定の立方体を取得

```
GET /api/cubes/:id
```

curlコマンド例:
```bash
curl -X GET http://localhost:3000/api/cubes/1618456789012
```

レスポンス例:
```json
{
  "id": 1618456789012,
  "size": 15,
  "color": 16711680,
  "position": { "x": 0, "y": 10, "z": 0 },
  "rotation": { "x": 0, "y": 0, "z": 0 }
}
```

### 特定の立方体を削除

```
DELETE /api/cubes/:id
```

curlコマンド例:
```bash
curl -X DELETE http://localhost:3000/api/cubes/1618456789012
```

レスポンス例:
```json
{
  "message": "立方体が削除されました"
}
```

### すべての立方体を削除

```
DELETE /api/cubes
```

curlコマンド例:
```bash
curl -X DELETE http://localhost:3000/api/cubes
```

レスポンス例:
```json
{
  "message": "すべての立方体が削除されました"
}
```
