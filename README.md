# Three.js 立方体ジェネレーター

このプロジェクトは、Three.jsを使用して、ボタンを押すと10x10x10の立方体オブジェクトが追加されるウェブアプリケーションです。また、HTTP APIを通じて外部からも立方体を追加・管理できます。追加されたオブジェクトの情報はJSONファイルに永続化されるため、サーバーを再起動しても保持されます。WebSocketを使用してリアルタイムに変更が反映されます。さらに、自然言語処理APIを使用することで、自然言語で立方体を操作することもできます。

## 機能

- ボタンをクリックすると、シーンに10x10x10の立方体が追加されます
- マウスでカメラを操作して、3Dシーンを自由に見ることができます
- HTTP APIを使用して、外部から立方体を追加・管理できます
- 追加されたオブジェクトの情報はJSONファイルに永続化されます
- WebSocketを使用してリアルタイムに変更が反映されます
- 自然言語処理APIを使用して、自然言語で立方体を操作できます

## 使用技術

- Three.js - 3Dグラフィックスライブラリ
- Node.js - サーバーサイドJavaScript
- Express - Webアプリケーションフレームワーク
- WebSocket - リアルタイム通信
- HTML/CSS/JavaScript
- ファイルシステム - データの永続化
- 自然言語処理 - テキストから立方体のパラメータを抽出

## セットアップ

1. 必要なパッケージをインストールします
   ```
   npm install
   ```

2. メインサーバーを起動します
   ```
   npm start
   ```

3. 自然言語処理サーバーを起動します（別のターミナルで）
   ```
   npm run mcp
   ```

4. ブラウザで `http://localhost:3000/index.html` にアクセスします
5. APIテストページは `http://localhost:3000/test.html` でアクセス可能

## 自然言語処理APIの使用方法

自然言語処理APIは、自然言語で立方体を操作するためのエンドポイントを提供します。

### メインエンドポイント

```
POST http://localhost:3001/api/nlp
```

このエンドポイントは、テキストの内容に基づいて適切なアクションを実行します。

リクエスト例:
```json
{
  "text": "赤い立方体を追加して"
}
```

### 立方体を追加

自然言語で立方体を追加できます。サイズ、色、位置、回転を指定できます。

例：
- 「赤い立方体を追加して」
- 「サイズ20の青い立方体を中央に追加して」
- 「X座標10、Y座標15、Z座標-5の位置に緑色の立方体を追加して」

```
POST http://localhost:3001/api/nlp/add-cube
```

リクエスト例:
```json
{
  "text": "赤い立方体を追加して"
}
```

### 立方体を削除

指定されたIDの立方体を削除します。

例：
- 「ID 1234567890の立方体を削除して」

```
POST http://localhost:3001/api/nlp/delete-cube
```

リクエスト例:
```json
{
  "text": "ID 1234567890の立方体を削除して"
}
```

### すべての立方体を削除

すべての立方体を削除します。

例：
- 「すべての立方体を削除して」
- 「シーンをクリアして」

```
POST http://localhost:3001/api/nlp/clear-cubes
```

### すべての立方体を取得

現在シーンに存在するすべての立方体の情報を取得します。

例：
- 「現在のシーンにある立方体を教えて」
- 「すべての立方体の情報を表示して」

```
GET http://localhost:3001/api/nlp/cubes
```

### 特定の立方体を取得

指定されたIDの立方体の情報を取得します。

例：
- 「ID 1234567890の立方体の情報を教えて」

```
GET http://localhost:3001/api/nlp/cubes/:id
```

### サポートされる自然言語の例

- **色**: 赤、緑、青、黄色、紫、オレンジ、ピンク、茶色、黒、白、グレー、シアン、マゼンタ、ライム、マルーン、ネイビー、オリーブ、ティール、バイオレット、シルバー、ゴールド
- **位置**: 中央、上、下、左、右、前、後ろ、手前、奥
- **サイズ**: 「サイズ20」、「20の大きさ」
- **位置の座標**: 「位置(10, 20, 30)」、「x 10 y 20 z 30」
- **回転**: 「回転(0.5, 1.0, 0.3)」

## 使い方

1. 「立方体を追加」ボタンをクリックして、シーンに立方体を追加します
2. マウスでドラッグして視点を変更できます

## データの永続化

このアプリケーションでは、追加された立方体のデータは`data.json`ファイルに保存されます。これにより、サーバーを再起動しても立方体のデータが保持されます。データファイルは自動的に作成・更新されるため、特別な設定は必要ありません。

## リアルタイム更新

このアプリケーションでは、WebSocketを使用してリアルタイムに変更を反映します。立方体が追加・削除されると、接続されているすべてのクライアントに通知が送信され、自動的に画面が更新されます。これにより、複数のクライアントから同時にアクセスしても、すべてのクライアントで同じ立方体が表示されます。

## HTTP API

このアプリケーションは、外部からアクセスできるHTTP APIを提供しています。すべてのAPI操作はデータファイルに永続化され、WebSocketを通じてリアルタイムに通知されます。

### 立方体の追加

```
POST /api/cubes
```

curlコマンド例:
```bash
curl -X POST http://localhost:3000/api/cubes \
  -H "Content-Type: application/json" \
  -d '{
    "size": 15,
    "color": 16711680,
    "position": { "x": 0, "y": 10, "z": 0 },
    "rotation": { "x": 0, "y": 0, "z": 0 }
  }'
```

リクエスト例:
```json
{
  "size": 15,
  "color": 16711680,
  "position": { "x": 0, "y": 10, "z": 0 },
  "rotation": { "x": 0, "y": 0, "z": 0 }
}
```

レスポンス例:
```json
{
  "id": 1618456789012,
  "size": 15,
  "color": 16711680,
  "position": { "x": 0, "y": 10, "z": 0 },
  "rotation": { "x": 0, "y": 0, "z": 0 }
}
```

### すべての立方体を取得

```
GET /api/cubes
```

curlコマンド例:
```bash
curl -X GET http://localhost:3000/api/cubes
```

レスポンス例:
```json
[
  {
    "id": 1618456789012,
    "size": 15,
    "color": 16711680,
    "position": { "x": 0, "y": 10, "z": 0 },
    "rotation": { "x": 0, "y": 0, "z": 0 }
  },
  {
    "id": 1618456789013,
    "size": 10,
    "color": 65280,
    "position": { "x": 10, "y": 5, "z": -5 },
    "rotation": { "x": 0.5, "y": 0.3, "z": 0.1 }
  }
]
```

### 特定の立方体を取得

```
GET /api/cubes/:id
```

curlコマンド例:
```bash
curl -X GET http://localhost:3000/api/cubes/1618456789012
```

レスポンス例:
```json
{
  "id": 1618456789012,
  "size": 15,
  "color": 16711680,
  "position": { "x": 0, "y": 10, "z": 0 },
  "rotation": { "x": 0, "y": 0, "z": 0 }
}
```

### 特定の立方体を削除

```
DELETE /api/cubes/:id
```

curlコマンド例:
```bash
curl -X DELETE http://localhost:3000/api/cubes/1618456789012
```

レスポンス例:
```json
{
  "message": "立方体が削除されました"
}
```

### すべての立方体を削除

```
DELETE /api/cubes
```

curlコマンド例:
```bash
curl -X DELETE http://localhost:3000/api/cubes
```

レスポンス例:
```json
{
  "message": "すべての立方体が削除されました"
}
```
